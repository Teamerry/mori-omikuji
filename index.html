<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>森のおみくじ | Tea Merry</title>

<style>
  /* ===== 可変パラメータ（まずここだけ調整） ===== */
  :root{
    /* カード（上ゾーン） */
    --card-top: 6vh;            /* 上からの距離 */
    --card-w: 86vw;             /* カード幅 */
    --card-max: 600px;          /* カード最大幅 */
    --card-zone-h: 44vh;        /* カードが使う縦ゾーン（下に行き過ぎないための上限） */

    /* 上の小妖精（カード右上あたり） */
    --fairy-top-x: 82%;         /* X位置（カード幅に対する%） */
    --fairy-top-y: 8%;          /* Y位置（カード高さに対する%） */
    --fairy-top-w: 15vw;        /* 幅 */
    --fairy-top-w-max: 90px;    /* 最大幅 */

    /* カップ（下） */
    --cup-w: 62vw;
    --cup-w-max: 520px;
    --cup-bottom: 14vh;         /* 画面下からの距離 */

    /* 吹き出し（カップの上。読めればカップは多少隠れてOK） */
    --balloon-w: 68vw;
    --balloon-w-max: 520px;
    --balloon-bottom-gap: 20vh; /* 画面下から＝カップより上に固定 */
    --balloon-center-shift: 8%; /* 中央から右へ寄せる（＋で右） */

    /* ツッコミ妖精（吹き出しの右に固定） */
    --buddy-w: 22vw;
    --buddy-w-max: 140px;
    --buddy-x-gap: 6%;          /* 吹き出し右端からの余白 */
    --buddy-y-gap: 6%;          /* 吹き出し上端からの余白 */

    /* ヒント（最初だけ表示） */
    --hint-gap: 10px;
  }

  /* PC幅で上書き（900px～） */
  @media (min-width:900px){
    :root{
      --card-top: 70px;
      --card-w: 86%;
      --card-max: 720px;
      --card-zone-h: 420px;

      --fairy-top-x: 86%;
      --fairy-top-y: 10%;
      --fairy-top-w: 90px; --fairy-top-w-max: 96px;

      --cup-w: 480px; --cup-w-max: 520px;
      --cup-bottom: 100px;

      --balloon-w: 560px; --balloon-w-max: 600px;
      --balloon-bottom-gap: 330px;
      --balloon-center-shift: 10%;

      --buddy-w: 120px; --buddy-w-max: 140px;
      --buddy-x-gap: 10%;
      --buddy-y-gap: 10%;

      --hint-gap: 12px;
    }
  }

  /* ===== ベース ===== */
  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body{ height:100%; margin:0; }
  body{
    font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
    color:#5a3b25;
    background:#f1e6d1 url('bg_forest.jpg') center/cover no-repeat fixed;
    display:grid; place-items:center;
  }
  .app{ position:relative; width:min(980px,100%); height:100dvh; overflow:hidden; }

  /* ===== カード（上ゾーンで完結） ===== */
  .card-wrap{
    position:absolute; left:50%; top:var(--card-top); transform:translateX(-50%);
    width:min(var(--card-w), var(--card-max));
    max-height:var(--card-zone-h);
    z-index:3;
  }
  .card-wrap > img{ width:100%; display:block; filter:drop-shadow(0 10px 24px rgba(71,52,41,.18)); }
  .t1,.t2{ position:absolute; left:22px; right:22px; color:#5a3b25; }
  .t1{ top:18px; font-weight:800; font-size:clamp(22px,4.2vw,38px); line-height:1.15; }
  .t2{ bottom:16px; font-size:clamp(13px,2.9vw,18px); line-height:1.9; }

  /* 上の固定妖精（カードの右上に相対配置） */
  .fairy-top{
    position:absolute;
    width:min(var(--fairy-top-w), var(--fairy-top-w-max));
    left:calc(50% - var(--card-w)/2 + var(--card-w) * var(--fairy-top-x) / 100);
    top:calc(var(--card-top) + var(--card-zone-h) * var(--fairy-top-y) / 100);
    translate:-50% 0;
    z-index:4; opacity:0;
    filter:drop-shadow(0 6px 14px rgba(71,52,41,.22));
  }

  /* ===== 吹き出し（カップのひとつ上／中央やや右） ===== */
  .balloon{
    position:absolute;
    left:calc(50% + var(--balloon-center-shift));
    bottom:var(--balloon-bottom-gap);
    transform:translateX(-50%);
    width:min(var(--balloon-w), var(--balloon-w-max));
    z-index:5; opacity:0;
  }
  .balloonText{
    position:absolute;
    left:calc(50% + var(--balloon-center-shift));
    bottom:calc(var(--balloon-bottom-gap) + 14px);
    transform:translateX(-50%);
    width:calc(min(var(--balloon-w), var(--balloon-w-max)) - 80px);
    text-align:center; font-weight:700; z-index:6; opacity:0;
    font-size:clamp(14px,3.5vw,18px); line-height:1.6;
  }
  .buddy{
    position:absolute; z-index:6; opacity:0;
    width:min(var(--buddy-w), var(--buddy-w-max));
    right:calc(50% - var(--balloon-center-shift) - (min(var(--balloon-w), var(--balloon-w-max))/2) - var(--buddy-x-gap));
    bottom:calc(var(--balloon-bottom-gap) + var(--buddy-y-gap));
    filter:drop-shadow(0 8px 16px rgba(71,52,41,.22));
  }

  /* ===== カップ（下） ===== */
  .cup{
    position:absolute; left:50%; bottom:var(--cup-bottom); transform:translateX(-50%);
    width:min(var(--cup-w), var(--cup-w-max)); cursor:pointer; z-index:2;
    filter:drop-shadow(0 12px 22px rgba(71,52,41,.28));
  }
  .cup:active{ transform:translateX(-50%) translateY(1px) scale(.997); }

  /* ヒント（最初だけ） */
  .hint{
    position:absolute; left:50%; bottom:calc(var(--cup-bottom) - var(--hint-gap));
    transform:translate(-50%, 100%);
    padding:8px 14px; border-radius:999px; background:rgba(255,255,255,.9); color:#5a3b25;
    font-weight:700; font-size:14px; z-index:1;
    box-shadow:0 6px 14px rgba(71,52,41,.12); opacity:.95;
    animation:hint 1.8s ease-in-out infinite;
  }
  @keyframes hint{
    0%,100%{ transform:translate(-50%, 100%) }
    50%{    transform:translate(-50%, 90%) }
  }

  /* ボタン */
  .btns{ position:absolute; left:0; right:0; bottom:14px; display:flex; justify-content:center; gap:14px; z-index:7; opacity:0; pointer-events:none; transition:opacity .28s; }
  .btns img{ height:48px; object-fit:contain; cursor:pointer; filter:drop-shadow(0 6px 12px rgba(71,52,41,.18)); }
  .btns.on{ opacity:1; pointer-events:auto; }

  /* アニメ */
  .fadeIn{ animation:fadeIn .35s ease-out forwards; }
  .popIn{  animation:popIn  .26s ease-out forwards; }
  .floatIn{animation:floatIn .6s cubic-bezier(.22,1,.36,1) forwards; }
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
  @keyframes popIn { from{opacity:0; transform:scale(.96)} to{opacity:1; transform:scale(1)} }
  @keyframes floatIn{ from{opacity:0; transform:translate(-50%,16px)} to{opacity:1; transform:translate(-50%,0)} }
</style>
</head>
<body>
  <main class="app" role="application" aria-label="森のおみくじ">
    <!-- カード上ゾーン -->
    <figure id="card" class="card-wrap" aria-live="polite">
      <img src="card_base.png" alt="">
      <figcaption>
        <div id="title" class="t1"></div>
        <div id="body"  class="t2"></div>
      </figcaption>
    </figure>

    <!-- カード右上の小妖精（固定） -->
    <img id="fairyTop" class="fairy-top" src="fairy_top.png" alt="森の精霊">

    <!-- 吹き出し（カップの上に固定・中央やや右） -->
    <img id="balloon" class="balloon" src="balloon.png" alt="">
    <div id="balloonText" class="balloonText"></div>
    <img id="buddy" class="buddy" src="buddy.png" alt="ツッコミ役">

    <!-- カップ -->
    <img id="cup" class="cup" src="cup.png" alt="ティーカップ">

    <!-- ヒント -->
    <div id="hint" class="hint">カップをクリックしてね</div>

    <!-- ボタン -->
    <div class="btns" id="btns">
      <img id="okawari" src="okawari.png" alt="おかわり？">
      <a id="homeLink" href="#"><img src="home_sign.png" alt="TeaMerryの森へ"></a>
    </div>
  </main>

<script>
  // 要素
  const cup = document.getElementById('cup');
  const hint = document.getElementById('hint');
  const card = document.getElementById('card');
  const title = document.getElementById('title');
  const body  = document.getElementById('body');
  const fairyTop = document.getElementById('fairyTop');
  const balloon = document.getElementById('balloon');
  const balloonText = document.getElementById('balloonText');
  const buddy = document.getElementById('buddy');
  const btns = document.getElementById('btns');
  const okawari = document.getElementById('okawari');
  const homeLink = document.getElementById('homeLink');

  // ★リンク差し替え
  homeLink.href = 'https://example.com';

  // おみくじ
  const fortunes = [
    {t:'ほかほか<br>大吉', b:'あたたかい飲み物を両手で包むように、あなたのまわりにも静かなぬくもりが集まる日。どんな話も、湯気の向こうでやさしくまとまっていきます。', q:'あったまったら、やさしさもよく出る。'},
    {t:'もこもこ<br>中吉', b:'誰かの笑い声が、不意にあなたをやわらげる。無理に元気を出さなくても、湯気のように気持ちは上向き。今日は、笑われるより笑う方がお得です。', q:'笑いジワ、今日のラッキー線。'},
    {t:'ぬるま湯<br>小吉', b:'今日は、あたため直しの日。ぬるめの紅茶みたいに、じんわりと心がほどけていく。あせらなくていい、味が出るのはもう少し先。', q:'せかさない。湯気のペースで。'},
    {t:'ティーバッグ<br>末吉', b:'少し渋い一日。でも、その渋みが深みになる。お湯の中で静かに広がるように、ゆっくり整っていく運気。今日は焦らず、ほどよく染み出す時間を楽しんで。', q:'渋みはコクの予告状。'}
  ];

  function show(el, cls){ el.style.opacity = 1; el.classList.remove('fadeIn','popIn','floatIn'); void el.offsetWidth; el.classList.add(cls||'fadeIn'); }
  function hideAll(){
    [card, fairyTop, balloon, balloonText, buddy].forEach(el=>{ el.style.opacity=0; el.style.animation='none'; });
    btns.classList.remove('on');
  }
  function init(){ hideAll(); hint.style.display='block'; hint.style.opacity=1; }
  init();

  let playing = false;
  function play(){
    if(playing) return;
    playing = true;
    hint.style.display='none';

    const f = fortunes[Math.floor(Math.random()*fortunes.length)];
    title.innerHTML = f.t;
    body.textContent = f.b;
    balloonText.textContent = f.q;

    // カード → 上の妖精 → 吹き出し → ボタン
    setTimeout(()=>{ show(card,'floatIn'); }, 200);
    setTimeout(()=>{ show(fairyTop,'fadeIn'); }, 500);
    setTimeout(()=>{ show(balloon,'popIn'); show(balloonText,'fadeIn'); show(buddy,'fadeIn'); }, 900);
    setTimeout(()=>{ btns.classList.add('on'); playing = false; }, 1200);
  }

  cup.addEventListener('click', play, {passive:true});
  cup.addEventListener('touchend', play, {passive:true});
  okawari.addEventListener('click', ()=>{ init(); setTimeout(play,120); });
</script>
</body>
</html>
