<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>森のおみくじ・テスト</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bgTop:#8da18c; --bgMid:#6f846f; --bgBot:#6b5a3e;
    --tea:#6B4E3D; --paper:#F0E6D5; --ink:#5A3B25;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{margin:0; background:linear-gradient(#fff0, #fff0), linear-gradient(180deg,var(--bgTop),var(--bgMid) 60%,var(--bgBot)); display:grid; place-items:center; font-family:"Noto Sans JP",system-ui,sans-serif; color:var(--ink);}

  .app{ width:min(420px, 100vw); height:100dvh; position:relative; overflow:hidden; }

  /* 背景の粒子（軽量） */
  .spark{position:absolute; inset:0; pointer-events:none}
  .spark i{position:absolute; width:4px; height:4px; border-radius:50%; background:rgba(255,255,255,.45); filter:blur(.5px); opacity:.1; animation:drift 8s ease-in-out infinite}
  .spark i:nth-child(odd){animation-duration:10s; opacity:.5}
  @keyframes drift{0%{transform:translateY(0)}50%{transform:translateY(-24px)}100%{transform:translateY(0)}}

  /* レイアウト */
  .stage{position:absolute; inset:0; display:grid; grid-template-rows: 1fr auto; align-items:end; padding:16px}
  .center{position:relative; display:grid; place-items:center}

  /* カップ画像 */
  .cup{position:absolute; left:50%; bottom:112px; transform:translateX(-50%); width:64%; cursor:pointer; filter:drop-shadow(0 10px 16px rgba(71,52,41,.25))}
  .cup:active{transform:translateX(-50%) translateY(1px) scale(.996)}

  /* 湯気（画像なし） */
  .steam{position:absolute; left:50%; bottom:calc(112px + 44%); transform:translateX(-50%); width:120px; height:120px; pointer-events:none}
  .steam i{position:absolute; bottom:0; width:36px; height:62px; left:50%; margin-left:-18px;
    background:
      radial-gradient(40px 26px at 50% 70%, #fff 0 45%, transparent 55%),
      radial-gradient(34px 22px at 50% 36%, #fff 0 45%, transparent 55%);
    filter:blur(2px); opacity:0; transform:translateY(10px) scale(.9)
  }
  .steam i:nth-child(1){left:30%}
  .steam i:nth-child(2){left:50%}
  .steam i:nth-child(3){left:70%}
  .steam.on i{animation:rise 2.6s ease-in-out forwards}
  .steam.on i:nth-child(2){animation-delay:.18s}
  .steam.on i:nth-child(3){animation-delay:.36s}
  @keyframes rise{
    0%{opacity:0;transform:translateY(10px) scale(.9)}
    20%{opacity:.45}
    60%{opacity:.55;transform:translateY(-42px) scale(1.02)}
    100%{opacity:0;transform:translateY(-80px) scale(1.06)}
  }

  /* 結果カード（土台PNG＋文字） */
  .cardWrap{position:absolute; top:56px; left:50%; transform:translateX(-50%); width:80%; max-width:360px; opacity:0; transform-origin:50% 85%}
  .cardImg{width:100%; display:block} /* ★ここにカード土台PNG */
  .cardText{position:absolute; inset:0; display:grid; align-content:center; padding:18px}
  .t1{font-weight:700; font-size:clamp(22px,6.2vw,28px); line-height:1.15; color:var(--ink)}
  .t2{margin-top:8px; font-size:clamp(14px,4.2vw,16px); line-height:1.6}

  /* 精霊PNG＆吹き出し */
  .fairy{position:absolute; right:6%; top:30%; width:28%; max-width:120px; opacity:0; filter:drop-shadow(0 8px 16px rgba(71,52,41,.22))}
  .balloon{position:absolute; right:12%; top:46%; width:56%; max-width:260px; opacity:0}
  .balloonText{position:absolute; right:16%; top:49%; width:50%; max-width:230px; padding:16px; text-align:center; font-weight:700; color:var(--ink); opacity:0}

  /* ボタン */
  .btn{place-self:center; margin-top:auto; height:46px; padding:0 22px; border:0; border-radius:16px; background:linear-gradient(#4E7B5B,#446b50); color:#fff; font-weight:700; letter-spacing:.06em; box-shadow:0 8px 16px rgba(78,123,91,.24)}
  .btn:active{transform:translateY(1px)}

  /* アニメ */
  .fadeIn{animation:fadeIn .4s ease-out forwards}
  .popIn{animation:popIn .28s ease-out forwards}
  .floatIn{animation:floatIn .5s cubic-bezier(.22,1,.36,1) forwards}
  @keyframes fadeIn{to{opacity:1}}
  @keyframes popIn{from{opacity:0; transform:scale(.96)} to{opacity:1; transform:scale(1)}}
  @keyframes floatIn{from{opacity:0; transform:translate(-50%,16px)} to{opacity:1; transform:translate(-50%,0)}}

  @media (prefers-reduced-motion: reduce){
    .steam i{animation-duration:1.2s}
  }
</style>
</head>
<body>
  <main class="app" role="application" aria-label="森のおみくじテスト">
    <div class="spark" aria-hidden="true"></div>
    <section class="stage">
      <div class="center">
        <!-- ★カップPNGのURL -->
        <img id="cup" class="cup" src="cup.png" alt="ティーカップ"> <!-- ★ここを差し替え -->
        <div id="steam" class="steam" aria-hidden="true"><i></i><i></i><i></i></div>

        <!-- 結果カード（画像＋テキスト） -->
        <figure id="card" class="cardWrap">
          <img id="cardImg" class="cardImg" src="card_base.png" alt=""> <!-- ★カード土台PNG -->
          <figcaption class="cardText">
            <div id="title" class="t1">ぬるま湯<br>小吉</div>
            <div id="body"  class="t2">今日は、あたため直しの日。ぬるめの紅茶みたいに、じんわりと心がほどけていく。あせらなくていい、味が出るのはもう少し先。</div>
          </figcaption>
        </figure>

        <!-- 精霊と吹き出し（PNG＋文字） -->
        <img id="fairy" class="fairy" src="fairy.png" alt="">     <!-- ★精霊PNG -->
        <img id="balloon" class="balloon" src="balloon.png" alt=""> <!-- ★吹き出しPNG（左しっぽ） -->
        <div id="balloonText" class="balloonText">ゆっくりでいいよ。湯気が教えてくれるから。</div>
      </div>

      <button id="reroll" class="btn">おかわり？</button>
    </section>
  </main>

<script>
  // 背景の粒子をちょっとだけ
  const spark = document.querySelector('.spark');
  for(let i=0;i<30;i++){ const e=document.createElement('i'); e.style.left=Math.random()*100+'%'; e.style.bottom=Math.random()*100+'%'; e.style.animationDelay=(Math.random()*6)+'s'; spark.appendChild(e); }

  const cup = document.getElementById('cup');
  const steam = document.getElementById('steam');
  const card = document.getElementById('card');
  const fairy = document.getElementById('fairy');
  const balloon = document.getElementById('balloon');
  const balloonText = document.getElementById('balloonText');
  const title = document.getElementById('title');
  const body  = document.getElementById('body');
  const reroll= document.getElementById('reroll');

  // おみくじ候補（タイトルは改行OK）
  const fortunes = [
    {t:'ほかほか<br>大吉', b:'あたたかい飲み物を両手で包むように、あなたのまわりにも静かなぬくもりが集まる日。どんな話も、湯気の向こうでやさしくまとまっていきます。', w:'ぬくもりも、カフェインも取りすぎ注意。'},
    {t:'もこもこ<br>中吉', b:'誰かの笑い声が、不意にあなたをやわらげる。無理に元気を出さなくても、湯気のように気持ちは上向き。今日は、笑われるより笑う方がお得です。', w:'笑いジワは運のしるし。'},
    {t:'ぬるま湯<br>小吉', b:'今日は、あたため直しの日。ぬるめの紅茶みたいに、じんわりと心がほどけていく。あせらなくていい、味が出るのはもう少し先。', w:'ゆっくりでいいよ。湯気が教えてくれるから。'},
    {t:'ティーバッグ<br>末吉', b:'少し渋い一日。でも、その渋みが深みになる。お湯の中で静かに広がるように、ゆっくり整っていく運気。今日は焦らず、ほどよく染み出す時間を楽しんで。', w:'急須をゆらすみたいに、気持ちも軽くね。'}
  ];

  function showSteam(){
    // 湯気
    steam.classList.remove('on'); void steam.offsetWidth; steam.classList.add('on');

    // 既存要素をリセット（非表示）
    [card, fairy, balloon, balloonText].forEach(el=>{
      el.style.opacity = 0;
      el.style.animation = 'none'; void el.offsetWidth; // reset
    });

    // 湯気が上がったら結果を出す
    setTimeout(showFortune, 2200);
  }

  function showFortune(){
    // ランダム選出
    const f = fortunes[Math.floor(Math.random()*fortunes.length)];
    title.innerHTML = f.t;
    body.textContent = f.b;
    balloonText.textContent = f.w;

    // アニメ順：カード → 精霊 → 吹き出し画像 → 吹き出し文字
    card.style.animation = 'floatIn .6s cubic-bezier(.22,1,.36,1) forwards';
    setTimeout(()=>{ fairy.style.animation='fadeIn .35s ease-out forwards'; }, 180);
    setTimeout(()=>{ balloon.style.animation='popIn .26s ease-out forwards'; }, 320);
    setTimeout(()=>{ balloonText.style.animation='fadeIn .22s ease-out forwards'; }, 460);
  }

  cup.addEventListener('click', showSteam);
  reroll.addEventListener('click', showSteam);

  // 初回はおだやかに出す
  setTimeout(showFortune, 600);
</script>
</body>
</html>
